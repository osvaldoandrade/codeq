<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>codeQ | The Queue for Event-Driven Agents</title>
    <meta name="description" content="codeQ is a reactive scheduling system backed by KVRocks. Persistent queues, strict leases, and O(1) operations on SSD.">
    <meta name="theme-color" content="#020617">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="codeQ | The Queue for Event-Driven Agents">
    <meta property="og:description" content="Reactive scheduling and completion system backed by persistent queues in KVRocks.">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            bg: '#020617',       // Slate 950
                            surface: '#0f172a',  // Slate 900
                            border: '#1e293b',   // Slate 800
                            primary: '#06b6d4',  // Cyan 500
                            secondary: '#8b5cf6',// Violet 500
                            success: '#10b981',  // Emerald 500
                            error: '#f43f5e',    // Rose 500
                            text: '#f8fafc',     // Slate 50
                            muted: '#64748b'     // Slate 500
                        }
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #020617;
            color: #f8fafc;
        }
        
        .glass-panel {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid #1e293b;
            transition: all 0.3s ease;
        }
        
        .glass-panel:hover {
            border-color: #06b6d4;
            box-shadow: 0 4px 30px -5px rgba(6, 182, 212, 0.2);
        }

        .glow-text {
            text-shadow: 0 0 20px rgba(6, 182, 212, 0.6);
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
        }

        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.5, 0, 0, 1);
        }
        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #334155; }

        .tree-line-v { width: 1px; background-color: #1e293b; margin: 0 auto; }
        .tree-line-h { height: 1px; background-color: #1e293b; }

        .blink {
            animation: blinker 1s linear infinite;
        }
        @keyframes blinker {
            50% { opacity: 0; }
        }

        code { font-family: 'JetBrains Mono', monospace; }

        .stat-card {
            border-left: 2px solid #06b6d4;
            padding-left: 1rem;
        }
    </style>
</head>
<body class="antialiased selection:bg-brand-primary selection:text-white font-mono">

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-50 border-b border-brand-border bg-brand-bg/90 backdrop-blur-md">
        <div class="container mx-auto px-6 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span class="font-display font-bold text-xl tracking-tight text-white hover:text-brand-primary transition-colors cursor-pointer uppercase">
                    <span class="text-brand-primary">::</span> codeQ
                </span>
            </div>
            
            <div class="hidden md:flex items-center gap-8 text-xs font-bold uppercase tracking-widest text-brand-muted">
                <a href="#overview" class="hover:text-white transition-colors">[Overview]</a>
                <a href="#architecture" class="hover:text-white transition-colors">[How it works]</a>
                <a href="#features" class="hover:text-white transition-colors">[Features]</a>
                <a href="#performance" class="hover:text-white transition-colors">[Benchmark]</a>
                <a href="#faq" class="hover:text-white transition-colors">[FAQ]</a>
            </div>

            <div class="flex items-center gap-4">
                <a href="https://github.com/osvaldoandrade/codeq/wiki" target="_blank" class="hidden sm:inline-flex items-center justify-center px-4 py-2 text-xs font-bold text-brand-muted uppercase tracking-wide hover:text-white transition-colors">
                    Docs
                </a>
                <a href="#get-started" class="hidden sm:inline-flex items-center justify-center px-4 py-2 text-xs font-bold text-black bg-white uppercase tracking-wide hover:bg-gray-200 transition-colors">
                    Get Started
                </a>
                <a href="https://github.com/osvaldoandrade/codeq" target="_blank" class="text-brand-muted hover:text-white transition-colors">
                    <i class="fa-brands fa-github text-lg"></i>
                </a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative pt-32 lg:pt-48 pb-12 overflow-hidden">
        <!-- Ambient Glow -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[600px] bg-gradient-radial from-brand-primary/10 to-transparent opacity-40 pointer-events-none"></div>

        <div class="container mx-auto px-4 text-center relative z-10">
            <h1 class="text-4xl md:text-7xl font-display font-bold leading-none mb-6 text-white tracking-tight reveal">
                The Queue for <span class="text-brand-primary glow-text">Agents</span>.
            </h1>
            
            <p class="text-lg text-brand-muted max-w-2xl mx-auto mb-10 font-sans reveal" style="transition-delay: 100ms;">
                Reactive task scheduling backed by KVRocks on SSDs. <br class="hidden md:block" />
                Persistent queues, strict lease ownership, and O(1) operations at a fraction of the cost.
            </p>
        </div>
    </header>

    <main class="space-y-32 pb-32">

        <!-- SECTION: VIDEO OVERVIEW (FIRST) -->
        <section id="overview" class="container mx-auto px-4 reveal">
            <div class="max-w-4xl mx-auto border border-brand-border bg-black shadow-2xl p-1 relative group">
                <div class="relative w-full pb-[56.25%] h-0 bg-brand-surface">
                    <iframe 
                        src="https://drive.google.com/file/d/12yzFutp9ts5mQCfR2cXW9AYwA47NrxqR/preview" 
                        class="absolute top-0 left-0 w-full h-full"
                        allow="autoplay"
                        allowfullscreen
                        frameborder="0">
                    </iframe>
                </div>
            </div>
        </section>

        <!-- SECTION: ARCHITECTURE INFOGRAM (SECOND) -->
        <section id="architecture" class="container mx-auto px-4 reveal" style="transition-delay: 200ms;">
            <div class="text-center mb-12">
                <h2 class="text-2xl md:text-3xl font-display font-bold mb-2 text-white uppercase tracking-tight">System Architecture</h2>
                <div class="h-1 w-10 bg-brand-secondary mx-auto"></div>
            </div>
            
            <div class="w-full h-[800px] border border-brand-border bg-black shadow-2xl rounded-xl overflow-hidden relative group">
                <iframe 
                    srcdoc='<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>codeQ | Architecture Infogram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: "Inter", sans-serif; background-color: #020617; color: #e2e8f0; overflow: hidden; }
        .font-mono { font-family: "JetBrains Mono", monospace; }
        
        /* Animations */
        @keyframes flow-dash { to { stroke-dashoffset: -20; } }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* UI Components */
        .glass-panel { 
            background: rgba(15, 23, 42, 0.6); 
            backdrop-filter: blur(12px); 
            border: 1px solid #1e293b; 
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .glass-panel:hover {
            border-color: #334155;
            background: rgba(30, 41, 59, 0.8); 
        }
        .glass-panel.active { 
            background: rgba(30, 41, 59, 0.95); 
            border-color: #06b6d4; 
            box-shadow: 0 0 40px rgba(6, 182, 212, 0.15); 
            transform: scale(1.02); 
            z-index: 50; 
        }
        .glass-panel.dimmed {
            opacity: 0.4;
            filter: grayscale(0.8);
            transform: scale(0.98);
        }
        
        /* Connectors (SVG) */
        .connector-line { 
            stroke: #334155; 
            stroke-width: 2; 
            fill: none; 
            transition: stroke 0.4s, opacity 0.4s; 
            opacity: 0.2;
        }
        .connector-line.active { 
            stroke: #06b6d4; 
            stroke-width: 3; 
            opacity: 1;
            filter: drop-shadow(0 0 4px rgba(6, 182, 212, 0.5)); 
            animation: flow-dash 1s linear infinite; 
            stroke-dasharray: 8 4; 
        }

        /* Layout Grid - 3 Columns, 3 Rows, Symmetrical */
        .arch-grid {
            display: grid;
            grid-template-columns: 1fr 320px 1fr; 
            grid-template-rows: 1fr 1fr 1fr;
            gap: 1.5rem;
            height: 100%;
            padding: 2rem;
            max-width: 1920px;
            margin: 0 auto;
            position: relative;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        .label-micro { font-size: 9px; text-transform: uppercase; letter-spacing: 0.05em; color: #64748b; font-weight: 700; margin-bottom: 4px; }
        .node-icon { font-size: 1.5rem; margin-bottom: 0.5rem; color: #94a3b8; }
        .glass-panel.active .node-icon { color: #fff; text-shadow: 0 0 10px rgba(6,182,212,0.8); }
    </style>
</head>
<body class="h-screen w-screen flex flex-col bg-[#020617]">
    
    <!-- Header -->
    <header class="h-16 border-b border-slate-800 flex items-center justify-between px-8 bg-[#020617]/90 backdrop-blur z-50 shrink-0">
        <div class="flex items-center gap-4">
            <div class="w-3 h-3 rounded-full bg-cyan-500 animate-pulse shadow-[0_0_10px_#06b6d4]"></div>
            <span class="font-display font-bold text-xl tracking-tight text-white">codeQ <span class="text-cyan-500 font-mono text-sm opacity-80 tracking-widest ml-2">// SYSTEM_VIEW</span></span>
        </div>
        <div class="flex items-center gap-8 text-xs font-mono text-slate-400">
            <div class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-violet-500 rounded-full"></div>PRODUCER_FLOW</div>
            <div class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-emerald-500 rounded-full"></div>CORE_LOGIC</div>
            <div class="flex items-center gap-2"><div class="w-1.5 h-1.5 bg-pink-500 rounded-full"></div>WORKER_FLOW</div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="flex-1 flex overflow-hidden relative">
        
        <!-- Sidebar Narrative -->
        <div class="w-[400px] h-full z-40 flex flex-col border-r border-slate-800 bg-[#0b1121]/95 backdrop-blur shadow-2xl shrink-0">
            <div class="flex-1 p-8 overflow-y-auto" id="narrative-box">
                <!-- Content injected via JS -->
                <div class="flex flex-col items-center justify-center h-full text-center space-y-8 animate-[fade-in_0.5s_ease-out]">
                    <div class="relative">
                        <div class="absolute inset-0 bg-cyan-500/20 blur-xl rounded-full"></div>
                        <div class="relative w-20 h-20 bg-[#0f172a] rounded-full flex items-center justify-center border border-cyan-500/50 text-cyan-400">
                            <i class="fa-solid fa-server text-3xl ml-1"></i>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-white font-display mb-2">Architecture Trace</h2>
                        <p class="text-cyan-500 font-mono text-xs tracking-[0.2em] uppercase">Status: Online</p>
                    </div>
                    <p class="text-slate-400 text-sm leading-relaxed max-w-xs mx-auto">
                        Visualização simétrica do fluxo de vida de uma tarefa no codeQ.
                    </p>
                    <button onclick="startTour()" class="group relative px-8 py-4 bg-cyan-950/50 text-cyan-400 font-mono text-sm font-bold tracking-widest rounded border border-cyan-500/30 hover:bg-cyan-500 hover:text-white hover:border-cyan-400 transition-all overflow-hidden">
                        <span class="relative z-10">START TRACE</span>
                        <div class="absolute inset-0 h-full w-full bg-cyan-500/10 scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-500"></div>
                    </button>
                </div>
            </div>

            <!-- Navigation Controls -->
            <div class="p-6 border-t border-slate-800 bg-[#020617]">
                <div class="flex justify-between items-center text-[10px] font-mono text-slate-500 mb-3">
                    <span class="tracking-widest">TRACE STEP</span>
                    <span id="step-counter" class="text-cyan-500">0 / 8</span>
                </div>
                <div class="w-full bg-slate-800 h-1 rounded-full overflow-hidden mb-6">
                    <div id="progress-bar" class="h-full bg-gradient-to-r from-cyan-600 to-cyan-400 w-0 transition-all duration-500 ease-out shadow-[0_0_10px_#06b6d4]"></div>
                </div>
                <div class="flex gap-3">
                    <button id="btn-prev" onclick="prevStep()" disabled class="px-4 py-3 rounded border border-slate-700 text-slate-400 hover:text-white hover:border-slate-500 disabled:opacity-30 disabled:hover:border-slate-700 transition-all text-xs font-mono font-bold"><i class="fa-solid fa-chevron-left"></i></button>
                    <button id="btn-next" onclick="nextStep()" disabled class="flex-1 px-4 py-3 rounded bg-slate-800 text-slate-500 font-mono text-xs font-bold transition-all border border-slate-700 flex items-center justify-center gap-2 group disabled:opacity-50">
                        <span>WAITING...</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Architecture Canvas -->
        <div class="flex-1 bg-[#020617] relative flex items-center justify-center overflow-hidden">
            <!-- Grid Background -->
            <div class="absolute inset-0 opacity-20 pointer-events-none" 
                 style="background-image: radial-gradient(#1e293b 1px, transparent 1px); background-size: 30px 30px;">
            </div>

            <!-- SVG Connector Layer (Full Screen) -->
            <svg class="absolute inset-0 w-full h-full pointer-events-none z-0" id="connector-layer">
                <!-- Dynamic Lines created by JS -->
            </svg>

            <!-- Architecture Diagram Grid (3x3 Symmetrical) -->
            <div class="arch-grid w-full h-full relative z-10">
                
                <!-- ROW 1: INPUT / CONTROL / OUTPUT -->
                
                <!-- 1.1 Producer -->
                <div id="node-producer" class="glass-panel rounded-xl p-5 border-t-4 border-t-indigo-500">
                    <div>
                        <div class="label-micro text-indigo-400">INPUT SOURCE</div>
                        <div class="text-lg font-bold text-white"><i class="fa-solid fa-user-astronaut node-icon text-indigo-500"></i> PRODUCER</div>
                    </div>
                    <div class="text-xs text-slate-400 font-mono bg-black/20 p-2 rounded">
                        Agent / CLI / API<br>
                        POST /v1/tasks
                    </div>
                </div>

                <!-- 1.2 API Gateway -->
                <div id="node-api" class="glass-panel rounded-xl p-5 border-t-4 border-t-cyan-500 scale-105 z-20 shadow-xl bg-slate-900/80">
                    <div>
                        <div class="label-micro text-cyan-400">CONTROL PLANE</div>
                        <div class="text-2xl font-bold text-white"><i class="fa-solid fa-network-wired node-icon text-cyan-500"></i> API SERVER</div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mt-2">
                         <div class="text-[10px] bg-slate-800 p-1 rounded text-center text-slate-300">Auth</div>
                         <div class="text-[10px] bg-slate-800 p-1 rounded text-center text-slate-300">Validate</div>
                    </div>
                </div>

                <!-- 1.3 Worker -->
                <div id="node-worker" class="glass-panel rounded-xl p-5 border-t-4 border-t-pink-500">
                    <div>
                        <div class="label-micro text-pink-400">CONSUMER</div>
                        <div class="text-lg font-bold text-white"><i class="fa-solid fa-robot node-icon text-pink-500"></i> WORKER</div>
                    </div>
                    <div class="text-xs text-slate-400 font-mono bg-black/20 p-2 rounded text-right">
                        External Pool<br>
                        Polling / Claim
                    </div>
                </div>


                <!-- ROW 2: QUEUES / ENGINE / LEASES -->

                <!-- 2.1 Pending Queue -->
                <div id="node-pending" class="glass-panel rounded-xl p-5 border-l-4 border-l-emerald-500">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="label-micro text-emerald-500">PRIORITY QUEUES</div>
                            <div class="text-lg font-bold text-white">PENDING</div>
                        </div>
                        <i class="fa-solid fa-layer-group text-emerald-500 opacity-50"></i>
                    </div>
                    <div class="space-y-1 mt-2">
                        <div class="h-2 w-full bg-emerald-900/50 rounded overflow-hidden"><div class="h-full w-3/4 bg-emerald-500/50"></div></div>
                        <div class="h-2 w-full bg-emerald-900/50 rounded overflow-hidden"><div class="h-full w-1/2 bg-emerald-500/30"></div></div>
                        <div class="h-2 w-full bg-emerald-900/50 rounded overflow-hidden"><div class="h-full w-1/4 bg-emerald-500/20"></div></div>
                    </div>
                    <div class="text-[10px] text-slate-500 font-mono mt-2 text-right">Tier 9..0</div>
                </div>

                <!-- 2.2 Scheduler Core -->
                <div id="node-scheduler" class="glass-panel rounded-xl p-5 border-x-4 border-x-cyan-600 bg-slate-900/60">
                    <div class="text-center">
                        <div class="label-micro text-cyan-500">CORE LOGIC</div>
                        <div class="text-xl font-bold text-white mb-2">SCHEDULER</div>
                    </div>
                    <div class="flex-1 flex items-center justify-center relative">
                         <!-- Visual representation of RPOPLPUSH -->
                         <div class="absolute inset-0 border border-dashed border-slate-700 rounded-full animate-[spin_10s_linear_infinite]"></div>
                         <i class="fa-solid fa-arrows-rotate text-3xl text-slate-600"></i>
                         <div class="absolute bg-slate-900 px-2 text-[10px] font-mono text-cyan-400">RPOPLPUSH</div>
                    </div>
                </div>

                <!-- 2.3 Active Leases -->
                <div id="node-leases" class="glass-panel rounded-xl p-5 border-r-4 border-r-pink-500">
                    <div class="flex justify-between items-start">
                        <i class="fa-solid fa-stopwatch text-pink-500 opacity-50"></i>
                        <div class="text-right">
                            <div class="label-micro text-pink-500">STATE TRACKING</div>
                            <div class="text-lg font-bold text-white">IN-PROGRESS</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mt-4">
                        <div class="bg-pink-900/20 border border-pink-500/30 p-2 rounded text-center">
                            <div class="text-lg font-bold text-pink-400">60s</div>
                            <div class="text-[8px] text-pink-300">TTL</div>
                        </div>
                        <div class="bg-slate-800/50 border border-slate-700 p-2 rounded text-center">
                            <div class="text-lg font-bold text-slate-300">Heartbeat</div>
                            <div class="text-[8px] text-slate-500">Active</div>
                        </div>
                    </div>
                </div>


                <!-- ROW 3: RETRY / STORAGE / RESULT -->

                <!-- 3.1 Delayed/DLQ -->
                <div id="node-delayed" class="glass-panel rounded-xl p-5 border-b-4 border-b-yellow-500">
                    <div>
                        <div class="label-micro text-yellow-500">RETRY LOGIC</div>
                        <div class="text-lg font-bold text-white">DELAYED / DLQ</div>
                    </div>
                    <div class="mt-2 flex gap-2">
                        <div class="flex-1 bg-yellow-900/20 p-2 rounded border border-yellow-500/20">
                            <i class="fa-solid fa-clock-rotate-left text-yellow-500 mb-1"></i>
                            <div class="text-[9px] text-yellow-200">Backoff</div>
                        </div>
                         <div class="flex-1 bg-red-900/20 p-2 rounded border border-red-500/20 opacity-50">
                            <i class="fa-solid fa-skull text-red-500 mb-1"></i>
                            <div class="text-[9px] text-red-200">Dead</div>
                        </div>
                    </div>
                </div>

                <!-- 3.2 KVRocks Storage -->
                <div id="node-kvrocks" class="glass-panel rounded-xl p-5 border-b-4 border-b-white bg-slate-950">
                    <div class="text-center">
                        <div class="label-micro text-white">PERSISTENCE LAYER</div>
                        <div class="text-xl font-bold text-white"><i class="fa-solid fa-database text-slate-400 mr-2"></i> KVROCKS</div>
                    </div>
                    <div class="mt-4 flex justify-center gap-4">
                         <div class="text-center">
                             <div class="w-16 h-8 bg-slate-800 rounded border border-slate-700 mx-auto mb-1"></div>
                             <div class="text-[9px] text-slate-500">SSD (RocksDB)</div>
                         </div>
                         <div class="text-center">
                             <div class="w-16 h-8 bg-slate-800 rounded border border-slate-700 mx-auto mb-1"></div>
                             <div class="text-[9px] text-slate-500">Lists/Hash</div>
                         </div>
                    </div>
                </div>

                <!-- 3.3 Results -->
                <div id="node-results" class="glass-panel rounded-xl p-5 border-b-4 border-b-blue-500">
                    <div class="text-right">
                        <div class="label-micro text-blue-500">FINAL STATE</div>
                        <div class="text-lg font-bold text-white">RESULTS</div>
                    </div>
                    <div class="mt-3 bg-blue-900/20 p-2 rounded border border-blue-500/20 flex items-center justify-between">
                        <i class="fa-solid fa-file-code text-blue-400"></i>
                        <div class="text-right">
                            <div class="text-[10px] text-blue-200 font-mono">task_id.json</div>
                            <div class="text-[8px] text-blue-400">COMPLETED</div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const narrativeBox = document.getElementById("narrative-box");
        const progressBar = document.getElementById("progress-bar");
        const stepCounter = document.getElementById("step-counter");
        const btnNext = document.getElementById("btn-next");
        const btnPrev = document.getElementById("btn-prev");
        const connectorLayer = document.getElementById("connector-layer");

        // Helper to find connections
        // We will define paths dynamically based on the step
        const steps = [
            {
                title: "1. Task Creation",
                tag: "PRODUCER",
                content: "O <strong>Producer</strong> envia uma requisição POST com o payload da tarefa. O <strong>API Server</strong> recebe, autentica o token JWT e valida os parâmetros.",
                nodes: ["node-producer", "node-api"],
                links: [["node-producer", "node-api"]]
            },
            {
                title: "2. Priority Enqueue",
                tag: "SCHEDULING",
                content: "O <strong>API Server</strong> determina a prioridade (0-9) e insere o ID da tarefa na fila <strong>Pending</strong> correta. O payload completo é persistido no <strong>KVRocks</strong>.",
                nodes: ["node-api", "node-pending", "node-kvrocks"],
                links: [["node-api", "node-pending"], ["node-api", "node-kvrocks"]]
            },
            {
                title: "3. Worker Poll",
                tag: "CLAIM",
                content: "O <strong>Worker</strong> faz polling ou recebe um sinal de webhook. Ele solicita uma tarefa (Claim) ao <strong>API Server</strong>.",
                nodes: ["node-worker", "node-api"],
                links: [["node-worker", "node-api"]]
            },
            {
                title: "4. Atomic Lease",
                tag: "LOGIC",
                content: "O <strong>Scheduler</strong> executa `RPOPLPUSH` atômico. Move a tarefa de <strong>Pending</strong> para <strong>In-Progress</strong> e cria uma chave de Lease com TTL.",
                nodes: ["node-api", "node-scheduler", "node-pending", "node-leases"],
                links: [["node-api", "node-scheduler"], ["node-scheduler", "node-pending"], ["node-scheduler", "node-leases"]]
            },
            {
                title: "5. Execution",
                tag: "PROCESSING",
                content: "O <strong>Worker</strong> recebe a tarefa e começa o processamento. Ele deve enviar <strong>Heartbeats</strong> periodicamente para renovar o TTL no <strong>In-Progress</strong>.",
                nodes: ["node-worker", "node-leases"],
                links: [["node-worker", "node-leases"]]
            },
            {
                title: "6. Failure / Nack",
                tag: "RETRY",
                content: "Se falhar, o worker envia Nack (ou o TTL expira). A tarefa move-se para <strong>Delayed</strong> com um backoff calculado. Após o tempo, volta para <strong>Pending</strong>.",
                nodes: ["node-leases", "node-delayed", "node-pending"],
                links: [["node-leases", "node-delayed"], ["node-delayed", "node-pending"]]
            },
            {
                title: "7. Completion",
                tag: "SUCCESS",
                content: "No sucesso, o Worker envia o resultado. O sistema remove o Lease de <strong>In-Progress</strong> e grava o output em <strong>Results</strong>.",
                nodes: ["node-worker", "node-results", "node-leases"],
                links: [["node-worker", "node-results"], ["node-results", "node-leases"]]
            },
            {
                title: "8. Persistence",
                tag: "STORAGE",
                content: "Todos os estados finais e payloads são garantidos no disco via <strong>KVRocks</strong> (SSD), liberando RAM e garantindo durabilidade.",
                nodes: ["node-results", "node-kvrocks"],
                links: [["node-results", "node-kvrocks"]]
            }
        ];

        let currentStep = -1;

        function drawLines(links) {
            // Clear existing lines
            connectorLayer.innerHTML = "";

            links.forEach(([startId, endId]) => {
                const startEl = document.getElementById(startId);
                const endEl = document.getElementById(endId);
                
                if(!startEl || !endEl) return;

                const startRect = startEl.getBoundingClientRect();
                const endRect = endEl.getBoundingClientRect();
                const containerRect = document.querySelector(".arch-grid").getBoundingClientRect();

                // Calculate centers relative to SVG container
                const x1 = startRect.left + startRect.width / 2 - containerRect.left;
                const y1 = startRect.top + startRect.height / 2 - containerRect.top;
                const x2 = endRect.left + endRect.width / 2 - containerRect.left;
                const y2 = endRect.top + endRect.height / 2 - containerRect.top;

                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                
                // Draw Curve
                const deltaX = Math.abs(x2 - x1);
                const deltaY = Math.abs(y2 - y1);
                
                let d = "";
                // If vertical alignment is close
                if (deltaX < 50) {
                    d = `M ${x1} ${y1} L ${x2} ${y2}`;
                } 
                // If horizontal alignment is close
                else if (deltaY < 50) {
                    d = `M ${x1} ${y1} L ${x2} ${y2}`;
                } 
                // Curve
                else {
                    const cp1x = x1; 
                    const cp1y = y1 + (y2 - y1) * 0.5;
                    const cp2x = x2;
                    const cp2y = y2 - (y2 - y1) * 0.5;
                    d = `M ${x1} ${y1} C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${x2} ${y2}`;
                }

                path.setAttribute("d", d);
                path.classList.add("connector-line", "active");
                connectorLayer.appendChild(path);
            });
        }

        function renderStep(index) {
            const step = steps[index];
            
            // Update Narrative
            narrativeBox.innerHTML = `
                <div class="animate-[fade-in_0.4s_ease-out]">
                    <div class="font-mono text-[10px] font-bold mb-3 px-2 py-1 rounded w-fit bg-cyan-900/30 text-cyan-400 border border-cyan-500/30 tracking-widest uppercase">
                        // ${step.tag}
                    </div>
                    <h2 class="text-2xl font-display font-bold mb-4 text-white leading-tight">${step.title}</h2>
                    <div class="text-sm leading-6 text-slate-300 font-light border-l-2 border-cyan-500/50 pl-4">
                        ${step.content}
                    </div>
                </div>
            `;

            // Dim all nodes first
            document.querySelectorAll(".glass-panel").forEach(el => {
                el.classList.remove("active");
                el.classList.add("dimmed");
            });

            // Highlight active nodes
            step.nodes.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.classList.remove("dimmed");
                    el.classList.add("active");
                }
            });

            // Draw connections
            drawLines(step.links);

            // Update UI Controls
            stepCounter.innerText = `${index + 1} / ${steps.length}`;
            progressBar.style.width = `${((index + 1) / steps.length) * 100}%`;
            
            btnPrev.disabled = index === 0;
            
            if (index === steps.length - 1) {
                btnNext.innerHTML = "<span>RESTART</span><i class=\"fa-solid fa-rotate-left text-emerald-400\"></i>";
                btnNext.onclick = startTour;
            } else {
                btnNext.innerHTML = "<span>NEXT</span><i class=\"fa-solid fa-chevron-right text-cyan-400\"></i>";
                btnNext.onclick = nextStep;
                btnNext.disabled = false;
            }
        }

        function startTour() {
            currentStep = 0;
            renderStep(currentStep);
        }

        function nextStep() {
            if (currentStep < steps.length - 1) {
                currentStep++;
                renderStep(currentStep);
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                renderStep(currentStep);
            }
        }

        // Initialize state
        document.querySelectorAll(".glass-panel").forEach(el => el.classList.add("dimmed"));
    </script>
</body>
</html>' 
                    class="absolute top-0 left-0 w-full h-full"
                    allowfullscreen
                    frameborder="0">
                </iframe>
            </div>
        </section>

        <!-- SECTION: CORE FEATURES -->
        <section id="features" class="container mx-auto px-4 reveal">
            <div class="text-center mb-16">
                <h2 class="text-2xl md:text-3xl font-display font-bold mb-2 text-white uppercase tracking-tight">CORE FEATURES</h2>
                <div class="h-1 w-10 bg-brand-primary mx-auto"></div>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
                <!-- Card 1 -->
                <div class="glass-panel p-8 group hover:bg-brand-surface/50 transition-all duration-300">
                    <div class="w-12 h-12 mb-6 flex items-center justify-center border border-brand-border bg-black group-hover:border-brand-primary/50 transition-colors">
                        <i class="fa-solid fa-hard-drive text-2xl text-brand-primary"></i>
                    </div>
                    <h3 class="text-white font-bold uppercase mb-3 tracking-wide">Disk Persistence</h3>
                    <p class="text-brand-muted text-sm leading-relaxed font-sans">
                        Backed by KVRocks (RocksDB on SSD). Keeps list operations <strong>O(1)</strong> while storing massive datasets on disk, not RAM.
                    </p>
                </div>
                <!-- Card 2 -->
                <div class="glass-panel p-8 group hover:bg-brand-surface/50 transition-all duration-300">
                    <div class="w-12 h-12 mb-6 flex items-center justify-center border border-brand-border bg-black group-hover:border-brand-secondary/50 transition-colors">
                        <i class="fa-solid fa-lock text-2xl text-brand-secondary"></i>
                    </div>
                    <h3 class="text-white font-bold uppercase mb-3 tracking-wide">Strict Leases</h3>
                    <p class="text-brand-muted text-sm leading-relaxed font-sans">
                        Workers claim exclusive leases (TTL). Crashed workers automatically release tasks back to the pool, guaranteeing <strong>at-least-once</strong> delivery.
                    </p>
                </div>
                <!-- Card 3 -->
                <div class="glass-panel p-8 group hover:bg-brand-surface/50 transition-all duration-300">
                    <div class="w-12 h-12 mb-6 flex items-center justify-center border border-brand-border bg-black group-hover:border-brand-success/50 transition-colors">
                        <i class="fa-solid fa-layer-group text-2xl text-brand-success"></i>
                    </div>
                    <h3 class="text-white font-bold uppercase mb-3 tracking-wide">Priority Tiers</h3>
                    <p class="text-brand-muted text-sm leading-relaxed font-sans">
                        Supports 10 priority levels (0-9). High-priority tasks jump the queue, ensuring critical agent operations are processed first.
                    </p>
                </div>
                <!-- Card 4 -->
                <div class="glass-panel p-8 group hover:bg-brand-surface/50 transition-all duration-300">
                    <div class="w-12 h-12 mb-6 flex items-center justify-center border border-brand-border bg-black group-hover:border-white/50 transition-colors">
                        <i class="fa-solid fa-stopwatch text-2xl text-white"></i>
                    </div>
                    <h3 class="text-white font-bold uppercase mb-3 tracking-wide">Backoff & DLQ</h3>
                    <p class="text-brand-muted text-sm leading-relaxed font-sans">
                        Configurable exponential backoff with jitter. Tasks exceeding `maxAttempts` move to a Dead Letter Queue (DLQ) for inspection.
                    </p>
                </div>
                <!-- Card 5 -->
                <div class="glass-panel p-8 group hover:bg-brand-surface/50 transition-all duration-300">
                    <div class="w-12 h-12 mb-6 flex items-center justify-center border border-brand-border bg-black group-hover:border-brand-primary/50 transition-colors">
                        <i class="fa-solid fa-satellite-dish text-2xl text-brand-primary"></i>
                    </div>
                    <h3 class="text-white font-bold uppercase mb-3 tracking-wide">Reactive Signals</h3>
                    <p class="text-brand-muted text-sm leading-relaxed font-sans">
                        Pull-based consumption with advisory Webhook signals. Wakes up idle workers immediately when new priority tasks arrive.
                    </p>
                </div>
                <!-- Card 6 -->
                <div class="glass-panel p-8 group hover:bg-brand-surface/50 transition-all duration-300">
                    <div class="w-12 h-12 mb-6 flex items-center justify-center border border-brand-border bg-black group-hover:border-brand-secondary/50 transition-colors">
                        <i class="fa-solid fa-square-check text-2xl text-brand-secondary"></i>
                    </div>
                    <h3 class="text-white font-bold uppercase mb-3 tracking-wide">Result Storage</h3>
                    <p class="text-brand-muted text-sm leading-relaxed font-sans">
                        Task results are persisted and queryable. Supports result callbacks (Webhooks) to notify upstream agents upon completion.
                    </p>
                </div>
            </div>
        </section>

        <!-- SECTION: INITIALIZATION -->
        <section id="get-started" class="container mx-auto px-4 reveal">
            <div class="text-center mb-12">
                <h2 class="text-2xl md:text-3xl font-display font-bold mb-2 text-white uppercase tracking-tight">Get started</h2>
                <div class="h-1 w-10 bg-brand-primary mx-auto"></div>
            </div>

            <div class="max-w-6xl mx-auto">
                <div class="border border-brand-border bg-black shadow-2xl">
                    <div class="flex border-b border-brand-border bg-brand-surface overflow-x-auto">
                        <button onclick="switchTab('cli-install')" id="btn-cli-install" class="px-6 py-3 text-xs font-bold text-white bg-black border-t-2 border-brand-primary tracking-wider transition-all">CLI</button>
                        <button onclick="switchTab('cli')" id="btn-cli" class="px-6 py-3 text-xs font-bold text-brand-muted hover:text-white hover:bg-black/50 tracking-wider transition-all">SERVER</button>
                        <button onclick="switchTab('config')" id="btn-config" class="px-6 py-3 text-xs font-bold text-brand-muted hover:text-white hover:bg-black/50 tracking-wider transition-all">WORKER (GO)</button>
                    </div>

                    <div id="content-cli-install" class="p-6 bg-black font-mono text-xs overflow-x-auto h-[350px] text-brand-text">
<pre><code class="language-bash"><span class="text-brand-muted"># 1. Install codeQ CLI via npm</span>
<span class="text-brand-primary">$</span> npm install -g @codeq/cli

<span class="text-brand-muted"># 2. Verify installation</span>
<span class="text-brand-primary">$</span> codeq --version
<span class="text-brand-success">codeq version 1.2.4</span>

<span class="text-brand-muted"># 3. Configure connection (optional)</span>
<span class="text-brand-primary">$</span> codeq config set endpoint http://localhost:8080</code></pre>
                    </div>

                    <div id="content-cli" class="p-6 bg-black font-mono text-xs overflow-x-auto h-[350px] text-brand-text hidden">
<pre><code class="language-bash"><span class="text-brand-muted"># 1. Start the codeQ server</span>
<span class="text-brand-primary">$</span> helm install codeq ./helm/codeq --set kvrocks.enabled=true

<span class="text-brand-muted"># 2. Enqueue a high-priority task for video rendering</span>
<span class="text-brand-primary">$</span> codeq task create \
    --event render_video \
    --priority 9 \
    --payload '{"jobId": 500, "codec": "h264"}'

<span class="text-brand-muted"># 3. Inspect queue depth</span>
<span class="text-brand-primary">$</span> codeq queue inspect render_video
<span class="text-brand-muted">> PENDING: 1 | IN_PROGRESS: 0 | DELAYED: 0</span>

<span class="text-brand-muted"># 4. Start a CLI worker pool (for testing)</span>
<span class="text-brand-primary">$</span> codeq worker start --events render_video --concurrency 5

<span class="text-brand-success">✔ Worker connected. Processing tasks...</span><span class="blink">_</span></code></pre>
                    </div>

                    <div id="content-config" class="p-6 bg-black font-mono text-xs overflow-x-auto h-[350px] text-brand-text hidden">
<pre><code class="language-go"><span class="text-brand-secondary">package</span> main

<span class="text-brand-secondary">func</span> <span class="text-brand-primary">workerLoop</span>() {
    client := codeq.NewClient(<span class="text-brand-success">"http://codeq-api:8080"</span>)
    
    <span class="text-brand-secondary">for</span> {
        <span class="text-brand-muted">// 1. Claim a task with a 60s lease</span>
        task, err := client.Claim([]<span class="text-brand-secondary">string</span>{<span class="text-brand-success">"render_video"</span>}, <span class="text-brand-secondary">60</span>)
        
        <span class="text-brand-secondary">if</span> task == <span class="text-brand-secondary">nil</span> {
            time.Sleep(<span class="text-brand-secondary">5</span> * time.Second) <span class="text-brand-muted">// Backoff</span>
            <span class="text-brand-secondary">continue</span>
        }

        <span class="text-brand-muted">// 2. Process work (Execute Agent logic)</span>
        result, err := processVideo(task.Payload)

        <span class="text-brand-muted">// 3. Submit Result (Atomic Completion)</span>
        <span class="text-brand-secondary">if</span> err != <span class="text-brand-secondary">nil</span> {
            client.Nack(task.ID, err.Error()) <span class="text-brand-muted">// Trigger Retry</span>
        } <span class="text-brand-secondary">else</span> {
            client.Complete(task.ID, result)  <span class="text-brand-muted">// Clear Lease</span>
        }
    }
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: PERFORMANCE -->
        <section id="performance" class="container mx-auto px-4 reveal">
            <div class="text-center mb-16">
                <h2 class="text-2xl md:text-3xl font-display font-bold mb-2 text-white uppercase tracking-tight">Benchmark</h2>
                <div class="h-1 w-10 bg-brand-primary mx-auto"></div>
                <p class="text-brand-muted mt-4 font-sans text-sm max-w-2xl mx-auto">
                    Why store queue data in RAM? codeQ leverages SSDs via KVRocks to provide massive capacity at a fraction of the cost of Redis.
                </p>
            </div>

            <div class="grid lg:grid-cols-2 gap-8 max-w-6xl mx-auto">
                
                <!-- Chart 1: Cost Efficiency -->
                <div class="glass-panel p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-sm font-bold uppercase tracking-widest text-white">Storage Cost vs Capacity</h3>
                        <span class="text-[10px] bg-brand-primary/20 text-brand-primary px-2 py-1 border border-brand-primary/30">INFRASTRUCTURE</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="latencyVolumeChart"></canvas>
                    </div>
                    <p class="text-[10px] text-brand-muted mt-4 font-sans italic text-center">
                        codeQ (SSD) scales linearly in cost, whereas standard Redis (RAM) hits a vertical cost wall as queue depth increases.
                    </p>
                </div>

                <!-- Chart 2: Latency Stability -->
                <div class="glass-panel p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-sm font-bold uppercase tracking-widest text-white">Latency vs Queue Depth</h3>
                        <span class="text-[10px] bg-brand-success/20 text-brand-success px-2 py-1 border border-brand-success/30">STABILITY</span>
                    </div>
                    <div class="chart-container">
                        <canvas id="accuracyCostChart"></canvas>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mt-4">
                        <div class="stat-card">
                            <div class="text-brand-primary font-bold text-lg">O(1)</div>
                            <div class="text-[9px] text-brand-muted uppercase">Enqueue/Dequeue Time</div>
                        </div>
                        <div class="stat-card border-brand-success">
                            <div class="text-brand-success font-bold text-lg">~1ms</div>
                            <div class="text-[9px] text-brand-muted uppercase">Added Latency (vs RAM)</div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- SECTION: FAQ -->
        <section id="faq" class="container mx-auto px-4 reveal">
            <div class="max-w-6xl mx-auto space-y-4">
                <div class="text-center mb-12">
                    <h2 class="text-2xl font-display font-bold mb-2 uppercase tracking-tight">Technical FAQ</h2>
                    <div class="h-1 w-10 bg-brand-muted mx-auto"></div>
                </div>
                
                <details class="group bg-brand-surface border border-brand-border">
                    <summary class="flex justify-between items-center font-bold cursor-pointer list-none p-5 text-white text-sm uppercase tracking-wide hover:bg-brand-border/50 transition-colors">
                        <span>Why use KVRocks instead of Redis?</span>
                        <span class="transition group-open:rotate-180"><i class="fa-solid fa-chevron-down text-brand-primary"></i></span>
                    </summary>
                    <div class="text-brand-muted text-sm leading-relaxed px-5 pb-5 pt-0 border-t border-brand-border font-sans mt-4">
                        Redis stores everything in RAM, which is expensive for large queues or historical result data. KVRocks implements the Redis protocol but stores data on SSD (via RocksDB). This allows terabytes of queue data at a fraction of the cost, with only a negligible (~1ms) latency penalty.
                    </div>
                </details>

                <details class="group bg-brand-surface border border-brand-border">
                    <summary class="flex justify-between items-center font-bold cursor-pointer list-none p-5 text-white text-sm uppercase tracking-wide hover:bg-brand-border/50 transition-colors">
                        <span>How does the Lease system work?</span>
                        <span class="transition group-open:rotate-180"><i class="fa-solid fa-chevron-down text-brand-primary"></i></span>
                    </summary>
                    <div class="text-brand-muted text-sm leading-relaxed px-5 pb-5 pt-0 border-t border-brand-border font-sans mt-4">
                        Unlike "fire-and-forget" systems, codeQ requires workers to <code>Claim</code> a task. This grants an exclusive lease (e.g., 60s). If the worker crashes or fails to heartbeat, codeQ automatically returns the task to the pending queue when the lease expires, guaranteeing reliability.
                    </div>
                </details>

                <details class="group bg-brand-surface border border-brand-border">
                    <summary class="flex justify-between items-center font-bold cursor-pointer list-none p-5 text-white text-sm uppercase tracking-wide hover:bg-brand-border/50 transition-colors">
                        <span>Is delivery strictly FIFO?</span>
                        <span class="transition group-open:rotate-180"><i class="fa-solid fa-chevron-down text-brand-primary"></i></span>
                    </summary>
                    <div class="text-brand-muted text-sm leading-relaxed px-5 pb-5 pt-0 border-t border-brand-border font-sans mt-4">
                        codeQ favors availability and throughput over global ordering. Tasks are FIFO within a specific shard and priority tier (0-9), but strict global ordering is not guaranteed across shards in distributed setups.
                    </div>
                </details>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="border-t border-brand-border bg-[#000000] py-12 font-mono text-xs">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-4 gap-8 mb-12">
                <div class="col-span-2">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="font-bold text-lg text-white tracking-widest uppercase">:: codeQ</span>
                    </div>
                    <p class="text-brand-muted max-w-sm mb-4">
                        The persistent queue for autonomous agents. Built for scale, durability, and cost-efficiency.
                    </p>
                    <p class="text-brand-primary">Supported by code|company</p>
                </div>
                
                <div>
                    <h5 class="font-bold text-white mb-4 uppercase tracking-widest">Related Projects</h5>
                    <ul class="space-y-2 text-brand-muted">
                        <li><a href="https://osvaldoandrade.github.io/neuron" target="_blank" class="hover:text-brand-primary hover:underline">Neuron</a></li>
                        <li><a href="https://osvaldoandrade.github.io/tikti" target="_blank" class="hover:text-brand-primary hover:underline">Tikti</a></li>
                        <li><a href="https://osvaldoandrade.github.io/ledgerdb" target="_blank" class="hover:text-brand-primary hover:underline">LedgerDB</a></li>
                        <li><a href="https://osvaldoandrade.github.io/sous" target="_blank" class="hover:text-brand-primary hover:underline">Sous</a></li>
                    </ul>
                </div>
                
                <div>
                    <h5 class="font-bold text-white mb-4 uppercase tracking-widest">System</h5>
                    <ul class="space-y-2 text-brand-muted">
                        <li><a href="https://github.com/osvaldoandrade/codeq" target="_blank" class="hover:text-brand-primary hover:underline">GitHub</a></li>
                        <li><a href="#" class="hover:text-brand-primary hover:underline">Docs</a></li>
                    </ul>
                </div>
            </div>
            <div class="text-center text-[10px] text-brand-muted border-t border-brand-border pt-8 uppercase tracking-widest">
                © 2026 codeQ Engineering. Tasks persist.
            </div>
        </div>
    </footer>

    <script>
        (function() {
            const colors = {
                primary: '#06b6d4',
                secondary: '#8b5cf6',
                success: '#10b981',
                muted: '#64748b',
                white: '#f8fafc'
            };

            Chart.defaults.color = colors.muted;
            Chart.defaults.borderColor = '#1e293b';
            Chart.defaults.font.family = "'JetBrains Mono', monospace";

            // Scroll Reveal
            document.addEventListener('DOMContentLoaded', () => {
                const reveals = document.querySelectorAll('.reveal');
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if(entry.isIntersecting) {
                            entry.target.classList.add('active');
                        }
                    });
                }, { threshold: 0.1 });
                reveals.forEach(el => observer.observe(el));
                initCharts();
            });

            // Tabs
            window.switchTab = function(tabName) {
                const tabs = ['cli-install', 'cli', 'config'];
                tabs.forEach(t => {
                    const btn = document.getElementById(`btn-${t}`);
                    const content = document.getElementById(`content-${t}`);
                    if (t === tabName) {
                        content.classList.remove('hidden');
                        btn.className = 'px-6 py-3 text-xs font-bold text-white bg-black border-t-2 border-brand-primary tracking-wider transition-all';
                    } else {
                        content.classList.add('hidden');
                        btn.className = 'px-6 py-3 text-xs font-bold text-brand-muted hover:text-white hover:bg-black/50 tracking-wider transition-all';
                    }
                });
            }

            function initCharts() {
                // Chart 1: Cost vs Volume (RAM vs SSD)
                const ctxLV = document.getElementById('latencyVolumeChart').getContext('2d');
                new Chart(ctxLV, {
                    type: 'line',
                    data: {
                        labels: ['10k', '100k', '1M', '10M', '100M'],
                        datasets: [
                            {
                                label: 'Redis (RAM Cost)',
                                data: [10, 50, 400, 3000, 25000],
                                borderColor: colors.secondary,
                                backgroundColor: colors.secondary,
                                borderWidth: 2,
                                tension: 0.4
                            },
                            {
                                label: 'codeQ (SSD Cost)',
                                data: [2, 5, 15, 40, 100],
                                borderColor: colors.primary,
                                backgroundColor: colors.primary,
                                borderWidth: 2,
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { title: { display: true, text: 'Monthly Cost ($)', font: { size: 10 } }, type: 'logarithmic' }
                        },
                        plugins: {
                            legend: { display: true, position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } }
                        }
                    }
                });

                // Chart 2: Latency vs Queue Depth
                const ctxAC = document.getElementById('accuracyCostChart').getContext('2d');
                new Chart(ctxAC, {
                    type: 'scatter',
                    data: {
                        datasets: [
                            {
                                label: 'Redis (RAM)',
                                data: [{x: 1000, y: 0.2}, {x: 10000, y: 0.3}, {x: 100000, y: 0.5}],
                                borderColor: colors.secondary,
                                backgroundColor: colors.secondary,
                                pointRadius: 5
                            },
                            {
                                label: 'codeQ (SSD)',
                                data: [{x: 1000, y: 1.2}, {x: 10000, y: 1.3}, {x: 100000, y: 1.4}, {x: 1000000, y: 1.5}],
                                borderColor: colors.primary,
                                backgroundColor: colors.primary,
                                pointRadius: 5
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { title: { display: true, text: 'Queue Depth (Items)', font: { size: 10 } }, type: 'logarithmic' },
                            y: { title: { display: true, text: 'Op Latency (ms)', font: { size: 10 } }, min: 0 }
                        },
                        plugins: {
                            legend: { display: true, position: 'bottom', labels: { boxWidth: 10, font: { size: 10 } } },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => `${ctx.dataset.label}: ${ctx.parsed.y}ms @ ${ctx.parsed.x} items`
                                }
                            }
                        }
                    }
                });
            }
        })();
    </script>
</body>
</html>
